{"title":"코스피200 변동성 조정 위클리 양매도 전략","markdown":{"headingText":"코스피200 변동성 조정 위클리 양매도 전략","headingAttr":{"id":"","classes":["unnumbered"],"keyvalue":[]},"containsRefs":false,"markdown":"\n25년도 봄학기 금융공학 특수논제 <사례로 보는 금융공학 실무> A조\n\n**김경재(20259048) / 강상묵(20259013) / 김형환(20249132) / 어환석(20259248) / 유수형(20259273)**\n\n```{r}\n#| echo: false\n#| eval: true\n#| warning: false\n#| error: false\n#| output: false\n\nrm(list=ls())\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(patchwork)\n\n# 1. 원본데이터 준비\noptions_raw <- read_csv(\"data/options_data.csv\") %>% tibble()\nidx_raw <- read_csv(\"data/idx_data.csv\") %>% tibble()\nmmf_raw <- read_csv(\"data/mmf.csv\") %>% tibble()\n\n# 2-1. 데이터 전처리 : KRX openAPI 옵션데이터 전처리\noptions <- options_raw %>% \n  # K200, WK200 이외의 옵션 제외\n  filter(substr(PROD_NM,1,3)==\"코스피\") %>%\n  # 종가가 없는 경우 익일 기준가격(이론가격) 사용\n  mutate(PRICE = as.double(if_else(TDD_CLSPRC==\"-\",NXTDD_BAS_PRC,TDD_CLSPRC))) %>% \n  drop_na(PRICE) %>% \n  select(BAS_DD,ISU_NM,PRICE,ACC_TRDVOL) %>% \n  separate(ISU_NM, into=c(\"PROD\",\"RGHT\",\"EXP\",\"EXER_PRC\"), sep=' ') %>%\n  mutate(EXER_PRC=as.double(EXER_PRC),\n         EXPMM=if_else(PROD==\"코스피200\",substr(EXP,3,6),substr(EXP,1,4)),\n         EXPWW=if_else(PROD==\"코스피200\",2,as.integer(substr(EXP,6,6)))) %>% \n  filter(EXER_PRC>min(idx_raw$KOSPI200)*0.85,\n         EXER_PRC<max(idx_raw$KOSPI200)*1.15,\n         PROD!=\"코스피위클리M\") %>% # 월요일 만기 위클리옵션 제외\n  mutate(PRIOR=as.integer(EXPMM)*10+EXPWW) # 만기가 짧은 순으로 우선순위 부여\n\n# 2-2. 데이터 전처리 : 옵션 만기일 데이터 생성\ntarget_date <- options %>% \n  distinct(.,BAS_DD, PRIOR) %>% \n  arrange(PRIOR, desc(BAS_DD)) %>% \n  group_by(PRIOR) %>% \n  slice(1) %>% \n  ungroup() %>% \n  distinct(BAS_DD) %>% \n  arrange(desc(BAS_DD)) %>% \n  filter(BAS_DD<20241231, BAS_DD>20200101)\n\n# 2-3. 데이터 전처리 : KRX 정보데이터시스템 K200 및 V-K200지수 전처리\nidx_data <- idx_raw %>%\n  arrange(BAS_DD) %>% \n  mutate(LAG_K200=lag(KOSPI200),\n         LAG_VK200=lag(VKOSPI200))\n\nK200_portfolio=idx_data %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  mutate(RATE=(KOSPI200-LAG_K200)/LAG_K200,\n         YEAR = substr(BAS_DD, 1, 4),\n         YM = ym(substr(BAS_DD, 1, 6))) %>%\n  group_by(YEAR, YM) %>%\n  summarise(RATE_K200 = if_else(is.na(prod(1 + RATE)),0,prod(1 + RATE)),\n            MMF = mean(MMF)/100,\n            .groups = \"drop\") %>%\n  ungroup()\n\n# 3-1. 포트폴리오 구성 : VW양매도 포트폴리오 기초정보 생성\ntarget_info <- target_date %>% \n  left_join(options, by=\"BAS_DD\") %>% \n  distinct(BAS_DD,PRIOR) %>% \n  arrange(desc(BAS_DD),PRIOR) %>% \n  group_by(BAS_DD) %>% \n  # 만기가 도래하는 옵션을 제외하고 우선순위가 높은 옵션 선택\n  slice(2) %>% \n  ungroup() %>% \n  arrange(desc(BAS_DD)) %>% \n  left_join(idx_data, by=\"BAS_DD\") %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  # 옵션 보유기간 및 단기금리(MMF) 계산\n  mutate(DIFF_DAY=as.integer(ymd(lag(BAS_DD))-ymd(BAS_DD)),\n         MMF=MMF*0.01) %>% \n  # 옵션 보유기간에 해당하는 시장기대변동성 계산(V-K200활용)\n  mutate(VOL=LAG_VK200*sqrt(DIFF_DAY)/sqrt(365)/100) %>%\n  # 변동성에 따른 옵션 행사가격 상단(2.5단위 올림) 및 하단(2.5단위 내림) 계산\n  mutate(TARGET_C_K=ceiling(KOSPI200*(1+VOL)*0.4)/0.4,\n         TARGET_P_K=floor(KOSPI200*(1-VOL)*0.4)/0.4) %>% \n  drop_na(DIFF_DAY) %>% \n  select(BAS_DD,VOL,DIFF_DAY,MMF,KOSPI200,LAG_VK200,PRIOR,TARGET_C_K,TARGET_P_K)\n\n# 3-2. 포트폴리오 구성 : VW양매도 포트폴리오 거래대상 옵션 정보 생성\ntarget_options <- target_info %>% \n  select(BAS_DD, PRIOR, TARGET_C_K, TARGET_P_K) %>% \n  pivot_longer(cols=c(\"TARGET_C_K\",\"TARGET_P_K\"),names_to = \"GRP\", values_to = \"EXER_PRC\") %>% \n  mutate(RGHT=substr(GRP,8,8)) %>% \n  left_join(options,by=c(\"BAS_DD\",\"PRIOR\",\"RGHT\",\"EXER_PRC\")) %>%\n  select(BAS_DD,GRP,PRICE,ACC_TRDVOL) %>% \n  pivot_wider(names_from = \"GRP\", values_from = c(\"PRICE\",\"ACC_TRDVOL\"))\n\n# 원금 100억원 가정\ncash = 10000*10000*100\n\n# 4. 포트폴리오 구현 : VW양매도 전략을 구현하여 일자별 손익 계산\nportfolio <- target_info %>% \n  left_join(target_options,by=\"BAS_DD\") %>% \n  arrange(BAS_DD) %>% \n  # 원금에 따른 옵션 매도수량 계산\n  mutate(SELL_AMT=cash/250000/KOSPI200) %>% \n  # 옵션 프리미엄(매도수익)) 계산\n  mutate(PREMIUM=SELL_AMT*(PRICE_TARGET_C_K+PRICE_TARGET_P_K)*250000) %>% \n  # 원금 및 프리미엄의 MMF 이자수익 및 권리행사손실 계산\n  mutate(INTEREST=(cash+replace_na(PREMIUM,0))*MMF*DIFF_DAY/365,\n         EXERCISE=(if_else(lead(KOSPI200)-TARGET_C_K>0,lead(KOSPI200)-TARGET_C_K,0)+\n                     if_else(TARGET_P_K-lead(KOSPI200)>0,TARGET_P_K-lead(KOSPI200),0))*250000*SELL_AMT) %>% \n  # 주단위 포트폴리오 손익 계산(원금 100억 가정, 당일 투자시 다음주 실현손익을 의미)\n  mutate(REVENUE=PREMIUM+INTEREST-EXERCISE) %>% \n  # 거래대상 옵션이 상장되어있지 않은 경우, MMF수익만 고려\n  mutate(REVENUE=if_else(is.na(REVENUE),INTEREST,REVENUE)) %>% \n  mutate(RATE=REVENUE/cash)  # 주단위 포트폴리오 수익률\n\n# 5. 비교군 포트폴리오 생성 : 월별 5% OTM 양매도 전략\noptions2 <- options %>% \n  filter(PROD==\"코스피200\")\n\n# 옵션 만기일(매달) 생성\ntarget_date2 <- options2 %>% \n  distinct(.,BAS_DD, PRIOR) %>% \n  arrange(PRIOR, desc(BAS_DD)) %>% \n  group_by(PRIOR) %>% \n  slice(1) %>% \n  ungroup() %>% \n  distinct(BAS_DD) %>% \n  arrange(desc(BAS_DD)) %>% \n  filter(BAS_DD<20241231, BAS_DD>20200101)\n\n# 일반 양매도 포트폴리오 기본 정보 생성\ntarget_info2 <- target_date2 %>% \n  left_join(options2, by=\"BAS_DD\") %>% \n  distinct(BAS_DD,PRIOR) %>% \n  arrange(desc(BAS_DD),PRIOR) %>% \n  group_by(BAS_DD) %>% \n  # 만기가 도래하는 옵션을 제외하고 우선순위가 높은 옵션 선택\n  slice(2) %>% \n  ungroup() %>% \n  arrange(desc(BAS_DD)) %>% \n  left_join(idx_data, by=\"BAS_DD\") %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  # 옵션 보유기간 및 단기금리(MMF) 계산\n  mutate(DIFF_DAY=as.integer(ymd(lag(BAS_DD))-ymd(BAS_DD)),\n         MMF=MMF*0.01,\n         VOL=0.05) %>%\n  # 변동성에 따른 옵션 행사가격 상단(2.5단위 올림) 및 하단(2.5단위 내림) 계산\n  mutate(TARGET_C_K=ceiling(KOSPI200*(1+VOL)*0.4)/0.4,\n         TARGET_P_K=floor(KOSPI200*(1-VOL)*0.4)/0.4) %>% \n  mutate(DIFF_DAY=if_else(is.na(DIFF_DAY),28,DIFF_DAY)) %>% \n  select(BAS_DD,VOL,DIFF_DAY,MMF,KOSPI200,LAG_VK200,PRIOR,TARGET_C_K,TARGET_P_K)\n\n# 일반 양매도 포트폴리오 거래대상 옵션\ntarget_options2 <- target_info2 %>% \n  select(BAS_DD, PRIOR, TARGET_C_K, TARGET_P_K) %>% \n  pivot_longer(cols=c(\"TARGET_C_K\",\"TARGET_P_K\"),names_to = \"GRP\", values_to = \"EXER_PRC\") %>% \n  mutate(RGHT=substr(GRP,8,8)) %>% \n  left_join(options2,by=c(\"BAS_DD\",\"PRIOR\",\"RGHT\",\"EXER_PRC\")) %>%\n  select(BAS_DD,GRP,PRICE,ACC_TRDVOL) %>% \n  pivot_wider(names_from = \"GRP\", values_from = c(\"PRICE\",\"ACC_TRDVOL\"))\n\n# 일반 양매도 포트폴리오 구현\nportfolio2 <- target_info2 %>% \n  left_join(target_options2,by=\"BAS_DD\") %>% \n  arrange(BAS_DD) %>% \n  # 원금에 따른 옵션 매도수량 계산\n  mutate(SELL_AMT=cash/250000/KOSPI200) %>% \n  # 옵션 프리미엄(매도수익)) 계산\n  mutate(PREMIUM=SELL_AMT*(PRICE_TARGET_C_K+PRICE_TARGET_P_K)*250000) %>% \n  # 원금 및 프리미엄의 MMF 이자수익 및 권리행사손실 계산\n  mutate(INTEREST=(cash+replace_na(PREMIUM,0))*MMF*DIFF_DAY/365,\n         EXERCISE=(if_else(lead(KOSPI200)-TARGET_C_K>0,lead(KOSPI200)-TARGET_C_K,0)+\n                     if_else(TARGET_P_K-lead(KOSPI200)>0,TARGET_P_K-lead(KOSPI200),0))*250000*SELL_AMT) %>% \n  mutate(EXERCISE=if_else(is.na(EXERCISE),0,EXERCISE)) %>% \n  # 주단위 포트폴리오 손익 계산(원금 100억 가정, 당일 투자시 다음주 실현손익을 의미)\n  mutate(REVENUE=PREMIUM+INTEREST-EXERCISE) %>% \n  # 거래대상 옵션이 상장되어있지 않은 경우, MMF수익만 고려\n  mutate(REVENUE=if_else(is.na(REVENUE),INTEREST,REVENUE)) %>% \n  mutate(RATE=REVENUE/cash) # 주단위 포트폴리오 수익률\n\n# 6. 성과분석 : VW양매도 포트폴리오\nperformance <- portfolio %>%\n  drop_na(PREMIUM, EXERCISE) %>%\n  mutate(YEAR = substr(BAS_DD, 1, 4),\n         YM = ym(substr(BAS_DD, 1, 6))) %>%\n  group_by(YEAR, YM) %>%\n  summarise(PREMIUM = sum(PREMIUM),\n            INTEREST = sum(INTEREST),\n            EXERCISE = sum(EXERCISE),\n            REVENUE = sum(REVENUE),\n            RATE = prod(1 + RATE),\n            .groups = \"drop\") %>%\n  ungroup()\n\n# 6. 성과분석 : 일반 양매도 포트폴리오\nperformance2 <- portfolio2 %>%\n  drop_na(PREMIUM, EXERCISE) %>%\n  mutate(YEAR = substr(BAS_DD, 1, 4),\n         YM = ym(substr(BAS_DD, 1, 6))) %>%\n  group_by(YEAR, YM) %>%\n  summarise(PREMIUM = sum(PREMIUM),\n            INTEREST = sum(INTEREST),\n            EXERCISE = sum(EXERCISE),\n            REVENUE = sum(REVENUE),\n            RATE = prod(1 + RATE),\n            .groups = \"drop\") %>%\n  ungroup()\n\n# 시각화 등\ngraph1_1 <- performance %>%\n  arrange(YM) %>%\n  left_join(K200_portfolio,by=c(\"YEAR\",\"YM\")) %>% \n  mutate(CUM_RATE = cumprod(RATE) * 100 - 100,\n         CUM_RATE_K200 = cumprod(RATE_K200) * 100 - 100) %>% \n  bind_rows(tibble(YM=ym(201912),CUM_RATE=0,CUM_RATE_K200=0))\n  \n\ngraph1_2 <- performance2 %>%\n  arrange(YM) %>%\n  left_join(K200_portfolio,by=c(\"YEAR\",\"YM\")) %>% \n  mutate(CUM_RATE = cumprod(RATE) * 100 - 100,\n         CUM_RATE_K200 = cumprod(RATE_K200) * 100 - 100) %>% \n  bind_rows(tibble(YM=ym(201912),CUM_RATE=0,CUM_RATE_K200=0))\n\ngraph1_3 <- graph1_1 %>%\n  inner_join(graph1_2, by = \"YM\", suffix = c(\"_1\", \"_2\")) %>%\n  mutate(REVENUE_DIFF = (REVENUE_1 - REVENUE_2) / 1e8)\n\ngraph2_1 <- performance %>%\n  arrange(YM) %>%\n  left_join(K200_portfolio,by=c(\"YEAR\",\"YM\")) %>% \n  filter(as.integer(YEAR) > 2021) %>%\n  mutate(CUM_RATE = cumprod(RATE) * 100 - 100,\n         CUM_RATE_K200 = cumprod(RATE_K200) * 100 - 100) %>% \n  bind_rows(tibble(YM=ym(202112),CUM_RATE=0,CUM_RATE_K200=0))\n\ngraph2_2 <- performance2 %>%\n  arrange(YM) %>%\n  left_join(K200_portfolio,by=c(\"YEAR\",\"YM\")) %>% \n  filter(as.integer(YEAR) > 2021) %>%\n  mutate(CUM_RATE = cumprod(RATE) * 100 - 100,\n         CUM_RATE_K200 = cumprod(RATE_K200) * 100 - 100) %>% \n  bind_rows(tibble(YM=ym(202112),CUM_RATE=0,CUM_RATE_K200=0))\n\ngraph2_3 <- graph2_1 %>%\n  inner_join(graph2_2, by = \"YM\", suffix = c(\"_1\", \"_2\")) %>%\n  mutate(REVENUE_DIFF = (REVENUE_1 - REVENUE_2) / 1e8)\n\ngraph3_1 <- portfolio %>%\n  mutate(YM = ym(substr(BAS_DD, 1, 6))) %>%\n  group_by(YM) %>%\n  summarise(TargetVol=mean(VOL),\n            Kospi200=mean(KOSPI200)) %>% ungroup()\n\ngraph1=ggplot() +\n  geom_line(data = graph1_1, aes(x = YM, y = CUM_RATE, color = \"Vol-adj. Weekly\"), size = 1) +\n  geom_point(data = graph1_1, aes(x = YM, y = CUM_RATE, color = \"Vol-adj. Weekly\"), shape = 16, size = 2) +\n  geom_line(data = graph1_2, aes(x = YM, y = CUM_RATE, color = \"5% OTM Monthly\"), size = 1) +\n  geom_point(data = graph1_2, aes(x = YM, y = CUM_RATE, color = \"5% OTM Monthly\"), shape = 16, size = 2) +\n  geom_line(data = graph1_1, aes(x = YM, y = CUM_RATE_K200, color = \"Kospi 200\"), size = 1, alpha=0.7) +\n  geom_point(data = graph1_1, aes(x = YM, y = CUM_RATE_K200, color = \"Kospi 200\"), shape = 16, size = 2,alpha=0.7) +\n  geom_bar(data = graph1_3, aes(x = YM, y = REVENUE_DIFF * 3),\n           stat = \"identity\", alpha = 0.5, fill = \"gray\") +\n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +\n  scale_y_continuous(limits = c(-30, 50), breaks = seq(-30, 50, 10), labels = scales::number_format(accuracy = 0.1),\n                     sec.axis = sec_axis(~ . / 3, name = \"Overperform (100M)\", breaks = c(-10, -5, 0, 5, 10), labels = c(\"-10\", \"-5\", \"0\", \"5\", \"10\"))) +\n  scale_color_manual(values = c(\"Vol-adj. Weekly\" = \"red\", \"5% OTM Monthly\" = \"blue\", \"Kospi 200\" = \"Green\")) +\n  labs(x = NULL, y = \"Cumulative Return (%)\", color = \"\") +\n  theme_minimal() +\n  theme(legend.position = c(0.4, 0.93), legend.direction = \"horizontal\")\n\ngraph2=ggplot() +\n  geom_line(data = graph2_1, aes(x = YM, y = CUM_RATE, color = \"Vol-adj. Weekly\"), size = 1) +\n  geom_point(data = graph2_1, aes(x = YM, y = CUM_RATE, color = \"Vol-adj. Weekly\"), shape = 16, size = 2) +\n  geom_line(data = graph2_2, aes(x = YM, y = CUM_RATE, color = \"5% OTM Monthly\"), size = 1) +\n  geom_point(data = graph2_2, aes(x = YM, y = CUM_RATE, color = \"5% OTM Monthly\"), shape = 16, size = 2) +\n  geom_line(data = graph2_1, aes(x = YM, y = CUM_RATE_K200, color = \"Kospi 200\"), size = 1, alpha=0.7) +\n  geom_point(data = graph2_1, aes(x = YM, y = CUM_RATE_K200, color = \"Kospi 200\"), shape = 16, size = 2,alpha=0.7) +\n  geom_bar(data = graph2_3, aes(x = YM, y = REVENUE_DIFF * 3),\n           stat = \"identity\", alpha = 0.5, fill = \"gray\") +\n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +\n  scale_y_continuous(limits = c(-30, 20), breaks = seq(-30, 30, 10), labels = scales::number_format(accuracy = 0.1),\n                     sec.axis = sec_axis(~ . / 3, name = \"Overperform (100M)\", breaks = c(-10, -5, 0, 5, 10), labels = c(\"-10\", \"-5\", \"0\", \"5\", \"10\"))) +\n  scale_color_manual(values = c(\"Vol-adj. Weekly\" = \"red\", \"5% OTM Monthly\" = \"blue\", \"Kospi 200\" = \"Green\")) +\n  labs(x = NULL, y = \"Cumulative Return (%)\", color = \"\") +\n  theme_minimal() +\n  theme(legend.position = c(0.4, 0.93), legend.direction = \"horizontal\")\n\ngraph3=ggplot() +\n  geom_line(data = graph3_1, aes(x = YM, y = Kospi200, color = \"Kospi 200\"), size = 1) +\n  geom_point(data = graph3_1, aes(x = YM, y = Kospi200, color = \"Kospi 200\"), shape = 16, size = 2) +\n  geom_bar(data = graph3_1, aes(x = YM, y = TargetVol * 7000),\n           stat = \"identity\", alpha = 0.7, fill = \"blue\") +\n  geom_hline(yintercept = 200, size=0.5, color = \"black\", alpha=0.5)+\n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +\n  scale_y_continuous(limits = c(0, 500), breaks = seq(100, 500, 100),\n                     sec.axis = sec_axis(~ . / 7000, name = \"Strike Range(Monthly)\", breaks = c(0, 0.025,0.05,0.075, 0.1), labels = c(\"0\",\"5%\", \"10%\",\"15%\", \"20%\"))) +\n  scale_color_manual(values = c(\"Kospi 200\" = \"red\")) +\n  labs(x = NULL, y = \"Kospi 200\", color = \"\") +\n  theme_minimal() +\n  theme(legend.position = c(0.1, 0.93), legend.direction = \"horizontal\")\n\n# 요약표 1 : VW포트폴리오\ntable1 <- portfolio %>%\n  drop_na(PREMIUM, EXERCISE) %>%\n  mutate(YEAR = substr(BAS_DD, 1, 4),\n         CNT=1,\n         NO=if_else(EXERCISE==0,1,0)) %>%\n  group_by(YEAR) %>%\n  summarise(Expiry = sum(CNT),\n            NoExercise = round(sum(NO)/sum(CNT),2),\n            Premium = round(mean(PREMIUM)/10000,0),\n            Interest = round(mean(INTEREST)/10000,0),\n            Loss = round(mean(EXERCISE)/10000,0),\n            Revenue = round(mean(REVENUE)/10000,0),\n            Return = round(prod(1 + RATE)-1,2),\n            .groups = \"drop\") %>% \n  left_join(K200_portfolio %>% group_by(YEAR) %>% summarise(Return_K200=round(prod(RATE_K200)-1,2)),\n            by=\"YEAR\")\n\n# 요약표 2 : 일반 포트폴리오\ntable2 <- portfolio2 %>%\n  drop_na(PREMIUM, EXERCISE) %>%\n  mutate(YEAR = substr(BAS_DD, 1, 4),\n         CNT=1,\n         NO=if_else(EXERCISE==0,1,0)) %>%\n  group_by(YEAR) %>%\n  summarise(Expiry = sum(CNT),\n            NoExercise = round(sum(NO)/sum(CNT),2),\n            Premium = round(mean(PREMIUM)/10000,0),\n            Interest = round(mean(INTEREST)/10000,0),\n            Loss = round(mean(EXERCISE)/10000,0),\n            Revenue = round(mean(REVENUE)/10000,0),\n            Return = round(prod(1 + RATE)-1,2),\n            .groups = \"drop\") %>% \n  left_join(K200_portfolio %>% group_by(YEAR) %>% summarise(Return_K200=round(prod(RATE_K200)-1,2)),\n            by=\"YEAR\")\n\n# 요약표 3 : 포트폴리오 변동성 비교\nVol1 <- graph1_1 %>% group_by(YEAR) %>% summarise(Vol=round(sd(RATE)*sqrt(12),2),\n                                                  Vol_K200=round(sd(RATE_K200)*sqrt(12),2))\nVol2 <- graph1_2 %>% group_by(YEAR) %>% summarise(Vol=round(sd(RATE)*sqrt(12),2))\n\ntable3 <- table1 %>% \n  select(YEAR,Return,Return_K200) %>% \n  left_join(Vol1, by=\"YEAR\") %>% \n  mutate(Return_main=Return,\n         Vol_main=Vol) %>% \n  select(YEAR, Return_main,Vol_main,Return_K200,Vol_K200) %>% \n  left_join(table2 %>% \n              select(YEAR,Return) %>% \n              left_join(Vol2, by=\"YEAR\") %>% \n              mutate(Return_sub=Return,\n                     Vol_sub=Vol) %>% \n              select(YEAR,Return_sub,Vol_sub), by=\"YEAR\") %>% \n  select(YEAR, Return_main, Return_sub, Return_K200, Vol_main, Vol_sub, Vol_K200)\n```\n\n## 1. 개요\n\n본 리포트는 옵션과 변동성지수를 활용한 **변동성 조정 위클리 양매도**전략을 알아보고, **과거 데이터를 통해 구현 및 검증**하기 위해 작성되었습니다. **변동성 조정 위클리 양매도**란 ***1.변동성 조정***, ***2.주단위 매도*** 두가지 특징을 통해 **기존 단점을 보완**한 양매도 전략으로, \"매주\" V-Kospi200를 이용해 행사가격 범위를 결정하고 콜/풋옵션을 매도(양매도)하게 됩니다.\n\n전략 소개에 앞서 필요한 배경지식을 다루고, 전략 소개 및 구현, 백테스팅 및 성과를 차례로 설명하겠습니다.\n\n## 2. 배경지식\n\n### 양매도 (Short strangle)\n\n**양매도란 옵션 거래전략**으로, 일반적으로 **만기일이 같은 외가격(OTM) 콜/풋옵션을 매도**하는 것을 의미합니다.\n\nOTM 옵션을 매도하므로, 만기일에 기초자산의 가격이 풋옵션의 행사가격과 콜옵션의 행사가격 사이라면 권리행사되지 않게 되고 **옵션 프리미엄(매도수익)을 그대로 얻을 수 있게 됩니다.**\n\n반면, **양매도는 시장의 변동성이 예상과 달리 큰 경우, 큰 손실이 발생할 수 있다는 단점**도 존재합니다. **수익은 프리미엄으로 한정**되어있으나, 시황 급변에 따른 **옵션 손실에는 제한이 없어** 원금 이상의 손실이 발생할 수도 있기 때문입니다.\n\n즉, 양매도는 높은 확률로 **안정적인 중수익을 보장하나 매우 낮은 확률로 큰 손실이 발생할 수 있는 전략**이며, **향후 시장의 변동성이 크지 않을 것이라 예측될 때 주로 사용**됩니다.\n\n![](image/shortstrangle.png){fig-align=\"center\" width=\"150mm\" height=\"50mm\"}\n\n#### 양매도 전략 예시\n\n국내의 경우 행사가격의 상하단을 등가격(ATM) $\\pm$ 5%로 설정한 양매도 ETN이 한 때 큰 인기를 끌었습니다. 대표적인 예시인 **월별 코스피200 OTM 5% 양매도 전략**의 거래방법을 살펴보면, 다음과 같습니다.\n\n1.  현재 코스피200지수를 기준으로 ATM+5%의 콜옵션과 ATM-5%의 풋옵션을 매도 (프리미엄 수익 발생)\n2.  다음달 만기일이 되면, 옵션은 청산(권리행사시 손실)되고 다시 ATM $\\pm$ 5%의 콜,풋옵션을 매도\n\n즉, **월단위로 옵션을 교체하게 되며 행사가격의 상하단은 ATM** $\\pm$ 5%로 고정한 양매도 전략입니다. 중위험-중수익으로 흥행에 성공한 상품이지만, **아래와 같은 한계점**도 존재합니다.\n\n1.  행사가격 범위가 고정되어있어 변동성 확대시 손실 가능성이 커지고, 변동성 축소시 프리미엄 수익이 크게 감소\n2.  옵션 교체주기가 1개월로, 그간 지수의 하락이 누적된다면 손실이 과도하게 커질 수 있음 (유동성 리스크)\n\n### 코스피200 변동성지수 (V-Kospi200 index)\n\n**코스피200 변동성 지수**란 주식 시장의 **변동성을 측정하는 지표**입니다. 코스피200 옵션 가격 기반의 내재변동성을 이용하여 산출되며, 향후 30일간 시장 변동성에 대한 투자자들의 기대를 나타내는 지수입니다.\n\n#### 주요 특징\n\n-   **시장 심리 반영**: 투자자들의 불안 심리를 반영하며, '공포 지수(Fear Index)'라고도 불림\n-   **옵션 가격 기반**: 코스피200 옵션 가격 기반의 내재변동성을 통해 산출되며, 여기에는 투자자들의 기대가 반영\n\n***그래프1 : 일별 코스피200지수 및 코스피200 변동성지수***\n\n![](image/vkospi.png){fig-align=\"center\" width=\"70%\"}\n\n### 코스피200 위클리옵션\n\n**코스피200 위클리옵션**이란 코스피200 지수를 기초자산으로 하는 **주간 단위의 옵션 거래 상품**을 말합니다. '19년 상장되었으며 기존의 월 단위 만기가 도래하는 옵션과는 달리, 매주 월/목요일에 만기가 도래하는 단기 옵션입니다.\n\n#### 주요 특징\n\n-   **세밀한 거래 지원**: 매주 월/목요일에 만기가 도래하여 단기적인 시장 변동에 대한 투자 및 위험 관리에 유리\n-   **다양한 투자 전략 활용:** 단기적인 시장 예측을 기반으로 다양한 투자 전략을 구사할 수 있습니다.\n\n## 3. 전략 소개 및 구현\n\n### 전략 개요\n\n변동성 조정 위클리 양매도(Volatility Adjusted Weekly Short strangle, VWss) 전략이란, 기존에 널리 활용되던 **월별 OTM 5% 양매도 전략**에 아래 두가지 방법을 결합한 전략을 의미합니다.\n\n1.  옵션의 교체주기를 \"매월\" -\\> \"매주\" 단위로 세분화\n2.  행사가격의 범위를 고정하는 것이 아니라 매 옵션 매도시점마다 시장 변동성을 고려하여 조정\n\n따라서, 기존과 달리 **주단위로 옵션을 교체하며, 행사가격의 범위는 교체시점에 매번 달라지게 됩니다.** 이를 위해 코스피200위클리옵션**을 사용하고, 변동성 지표는** 내재변동성 기반의 V-Kospi200지수를 사용\\*\\*하여 구현할 계획입니다.\n\n### 행사가격 범위 설정방법\n\n행사가격의 상하단은 **옵션 매도시점의 \"전일 V-Kospi200 종가\"를 참조하여 설정**할 예정입니다. V-Kospi200는 향후 30일간 코스피200 지수의 변동성을 수치화한 지표로서, 현재시점에서 변동성을 잘 예측할 수 있는 수단이기 때문입니다.\n\n다만, 본 전략에서 옵션 매도포지션의 유지기간은 약 7일이므로 지수 종가(연율)를 주단위 기간에 맞도록 환산하여 행사가격의 상하단을 산출하였습니다.\n\n$$\\sigma_{Target}\\;=\\;\\frac{VKospi200_{(T-1)}\\times\\sqrt{Calendar\\;days}}{\\sqrt{365}}$$\n\n$$Call\\;strike\\;=\\;Kospi200_{(T)}\\times (1+\\sigma_{Target})\\;rounded\\;up\\;to\\;2.5pt$$\n\n$$Put\\;strike\\;=\\;Kospi200_{(T)}\\times (1-\\sigma_{Target})\\;rounded\\;down\\;to\\;2.5pt$$\n\n이렇게 행사가격을 설정하면 V-Kospi200가 15pt일 때 월환산 변동성이 약 5%(주환산 2.5%)가 됩니다. 즉,\n\n-   시장의 예상 변동성(V-Kospi200)이 연 15% 이상 -\\> 행사가격 범위를 기존보다 넓게 설정하여 손실 가능성 축소\n-   시장의 예상 변동성이 연 15% 미만 -\\> 행사가격 범위를 기존보다 좁게 설정하여 프리미엄 수익 극대화\n\n::: callout\n본 전략은 위클리옵션을 사용하므로 향후 1주일 변동성이 필요합니다. 따라서, 30일 변동성을 나타내는 V-Kospi200은 만기 mismatch가 있지만, 단기간의 예측치에는 큰 차이가 없고 이외의 대안(e.g. 7-day VIX)이 없어 V-Kospi200를 그대로 사용하였습니다.\n:::\n\n### 포트폴리오 구성 방법\n\n먼저, 편의를 위해 세금/수수료/호가스프레드 등의 거래비용은 없으며 종가에 원하는 수량만큼 거래할 수 있는 **완전자본시장을 가정**하도록 하겠습니다. 전략 구현을 위한 포트폴리오(투자원금 100억원) 구성 과정은 아래와 같습니다.\n\n1.  전일 V-Kospi200 지수를 주단위로 환산하여 예상변동성($\\hat\\sigma=(VKospi200\\times \\sqrt{day})/\\sqrt{365}$) 산출\n2.  예상변동성을 당일 Kospi200지수에 적용하여 행사가격 상하단(ATM $\\pm\\hat\\sigma$을 2.5pt 단위로 올림/내림) 산출\n3.  당일 Kospi200지수 및 승수(25만)를 적용, 옵션 매도수량($Q_{sell}=nominal/(kospi200\\times multiplier)$) 산출\n4.  행사가격 상단 콜옵션, 하단 풋옵션 매도 ($Premium=(call price+put price)\\times Q_{sell}\\times multiplier$)\n5.  원금과 매도수익을 다음주 만기일까지 MMF에 투자 ($Interest=(nominal+Premium)\\times MMF \\times \\frac{day}{365}$)\n6.  다음주 만기일이 되면, 권리행사 손실을 포함하여 최종손익 산출($Revenue=Premium+Interest-Exercise$)\n    -   Kospi200 \\> 행사가격 상단, 콜옵션에서 손실 발생($Exercise=(Kospi200-Strike_{call})\\times multiplier$)\n    -   Kospi200 \\< 행사가격 하단, 풋옵션에서 손실 발생($Exercise=(Strike_{put}-Kospi200)\\times multiplier$)\n    -   이외의 경우, 권리행사되지 않아 옵션 포지션 청산($Exercise=0$)\n7.  주간 최종손익을 정산($nominal_{new}=nominal_{old}+Revenue$)하고, 투자종료시점까지 1. \\~ 6. 과정을 반복\n\n## 3. Backtesting\n\n### 데이터 수집 및 전처리, 포트폴리오 구현\n\n과거 5개년(2020\\~2024) 코스피200 등의 지수/옵션 가격, 금리를 수집하였으며, 출처는 아래와 같습니다.\n\n```         \n한국거래소 정보데이터시스템(data.krx.co.kr) : 코스피200 및 V-Kospi200지수\n한국거래소 OpenAPI(openapi.krx.co.kr) : 코스피200옵션 및 위클리옵션 종목별 가격\n한국은행 경제통계시스템(ecos.bok.or.kr) : 일별 MMF(7일) 금리\n```\n\n::: {.callout-note title=\"한국거래소 OpenAPI를 활용한 데이터 수집 예시\"}\n![](image/krxopenapi1.png){fig-align=\"center\" width=\"60%\"}\n\nAPI 호출시 json 데이터를 수집할 수 있으며, 이를 Dataframe(python) 및 tibble(r)로 변환하여 활용하였습니다.\n\n```{python}\nimport requests; import json\nurl = 'http://data-dbg.krx.co.kr/svc/sample/apis/drv/opt_bydd_trd?basDd=20250312'\nheaders = {'AUTH_KEY': '74D1B99DFBF345BBA3FB4476510A4BED4C78D13A'}\nres = requests.get(url=url, headers=headers); res.text\n```\n:::\n\n수집한 데이터는 **R을 이용하여 전처리**하였으며, 두개의 데이터셋으로 요약하였습니다.\n\n1.  **포트폴리오 기본 정보** : 옵션 만기일(매주), 옵션 보유일, MMF금리, Kospi200, 전일 V-K200, 거래대상옵션 정보\n\n```{r}\n#| echo: false\nkable(head(target_info))\n```\n\n2. **거래대상옵션 정보** : 포트폴리오 기본 정보에 대응되는 거래대상옵션의 종가, 거래량(0인 경우 제외)\n\n```{r}\n#| echo: false\nkable(head(target_options))\n```\n\n이를 통해 매도수량, 프리미엄, 이자수익, 권리행사손실 등을 산출하여 **포트폴리오를 구현**하였습니다.\n\n```{r}\n#| echo: false\nkable(portfolio %>% select(BAS_DD,VOL,SELL_AMT,PREMIUM,INTEREST,EXERCISE,REVENUE,RATE) %>% head())\n```\n\n\\newpage\n\n::: {.callout-important title=\"변동성 조정 방법에 따른 행사가격 범위 추이(과거 5년)\"}\n\nV-Kospi200과 연동한 행사가격의 범위는 지난 5년간 **1.6% \\~ 8.7%까지 광범위하게 형성**되었습니다.\n\n코스피200이 급등락하는 경우 범위가 넓게 형성되고 보합장에서는 좁게 형성되는 추이를 확인할 수 있으며, 이를 월환산($\\times\\sqrt{4}$)하여 기존 5%와 비교하면 **지수의 상황에 따라 유동적으로 조절되고 있음**을 의미합니다.\n\n\\\n\n***그래프2 : 월평균 코스피200지수(적색) 및 행사가격 범위(청색)***\n\n```{r}\n#| echo: false\n#| warning: false\ngraph3\n```\n\n:::\n\n\\newpage\n\n### Backtesting 성과\n\n**지난 5년간(2020\\~2024) VW양매도와 코스피200지수 / OTM 5% 양매도를 비교**해보았습니다.\n\n***표1 : 연도별 변동성 조정 위클리 양매도 포트폴리오 및 코스피200지수 성과***\n\n```{r}\n#| echo: false\nkable(table1)\n```\n\n***표2 : 연도별 일반 양매도 포트폴리오 및 코스피200지수 성과***\n\n```{r}\n#| echo: false\nkable(table2)\n```\n\n::: callout\n**YEAR** : 산출대상 연도 / **Expiry** : 옵션만기 횟수 (프리미엄 수익 발생 횟수)\n\n**NoExercise** : 옵션만기일에 행사되지 않은 비율 (손실이 발생하지 않은 거래일 비율)\n\n**Premium** : 평균 옵션 프리미엄 수익 (만원) / **Interest** : 원금 및 프리미엄에서 발생한 평균 이자수익 (만원)\n\n**Loss** : 옵션권리행사로 인한 평균 손실 (미행사 포함) / **Revenue** : 평균 이익 (Premium + Interest - Loss)\n\n**Return** : 포트폴리오의 연환산 수익률 / **Return_K200** : 코스피200지수의 연환산 수익률\n:::\n\n**변동성 조정 위클리 양매도 포트폴리오**의 주요 성과는 다음과 같습니다.\n\n1.  옵션 매도주기 축소(월간 $\\rightarrow$ 주간) : **현금흐름 개선 및 프리미엄 수익 극대화**\n\n-   VW양매도 포트폴리오는 연평균 50회의 수익이 발생하는 반면, 일반 양매도 포트폴리오는 12회(월1회) 발생.\n-   1회 발생 수익은 4배 미만으로 감소하여 평균 수익이 증가하였고, 수익주기가 짧아지면서 현금유동성 개선\n\n2.  행사가격 범위 조정(5% $\\rightarrow$ $\\sigma$연동) : **포트폴리오 안정성 증가 및 리스크 축소**\n\n-   일반 양매도 전략의 손실발생비율(권리행사비율)은 시장 상황에 따라 0\\~50%까지 큰 폭으로 변동\n-   반면, 본 포트폴리오는 행사가격 범위를 변동성 수준에 조정하므로 비율이 10\\~30%수준으로 안정화\n-   손실에 대한 예측가능성 및 포트폴리오 변동성이 개선되었으며 1회 손실도 감내 가능한 수준으로 축소\n\n3.  **소결 : VW양매도 전략은 수익률, 리스크 측면에서 코스피200지수 및 일반 양매도 전략을 Outperform**\n\n\\newpage\n\n***그래프3, 4 : 지난 5년 및 3년간 코스피200지수, VW양매도, 5%양매도 누적수익률 및 초과수익***\n\n```{r}\n#| echo: false\n#| warning: false\ngraph1\n```\n\n```{r}\n#| echo: false\n#| warning: false\ngraph2\n```\n\n***표3 : 연도별 VW양매도, 일반 양매도, 코스피200지수의 수익률 및 변동성(월간수익률의 연환산)***\n\n```{r}\n#| echo: false\n#| warning: false\nkable(table3)\n```\n\n그래프와 표를 통해 **VW양매도 전략**이 타 전략 대비 **안정적이고 높은 수익을 실현**하였음을 확인할 수 있었습니다.\n\n### 한계점\n\n그러나, **행사가격 범위가 전일 V-Kospi200 지수에 따라 결정**되므로 옵션 매도일 및 보유기간 중 V-Kospi200 지수가 급등락하는 경우 **시장 변동성을 적절히 반영되지 않을 가능성**이 있습니다.\n\n-   당일 장중 지수를 사용할 수 있겠으나 종가보다 신뢰성이 높다고 보기 어렵고, 당일 종가는 매도시점에서 확인 불가\n-   보유기간 중 V-Kospi200의 변동에 따라 옵션 행사가격을 리밸런싱하면 보다 정확히 변동성을 반영할 수 있으나, 잦은 거래로 인해 수반되는 비용이 급증\n-   시장 변동성이 적절히 반영되지 않는 경우, 프리미엄 수익성이 낮아지고 옵션 권리행사 위험이 증가할 수 있음\n\n또한, **실제로 VW양매도 포트폴리오를 운영**한다면 **거래비용 및 유동성 등의 한계점**으로 인해 보완해야할 점이 있으며 이 과정에서 초과수익률 등의 **성과가 다소 희석**될 것으로 예상됩니다.\n\n-   수수료/유동성 등으로 인해 자주 옵션을 매도하는 전략 특성상 거래비용 상승이 수반됨\n-   월물 옵션 대비 위클리옵션의 유동성이 낮아, 변동성 확대 국면에서 원하는 위클리옵션의 거래가 없을 수 있음\n\n## 4. 포트폴리오 검증 ('25.3.13 ~ 4.10)\n\n포트폴리오의 성과 검증을 위해 **'25년 3월 옵션만기일부터 1개월간의 성과를 측정**해보겠습니다.\n\n**Backtesting과 동일한 방식으로 진행**하였으며, 날짜 등 일부를 제외하고 동일 코드를 재사용하였습니다.\n\n```{r}\n#| echo: false\n#| eval: true\n#| warning: false\n#| error: false\n#| output: false\n\nrm(list=ls())\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(patchwork)\n\n# 1. 원본데이터 준비\noptions_raw <- read_csv(\"data/options_data_test.csv\") %>% tibble()\nidx_raw <- read_csv(\"data/idx_data_test.csv\") %>% tibble()\nmmf_raw <- read_csv(\"data/mmf_test.csv\") %>% tibble()\n\n# 2-1. 데이터 전처리 : KRX openAPI 옵션데이터 전처리\noptions <- options_raw %>% \n  # K200, WK200 이외의 옵션 제외\n  filter(substr(PROD_NM,1,3)==\"코스피\") %>%\n  # 종가가 없는 경우 익일 기준가격(이론가격) 사용\n  mutate(PRICE = as.double(if_else(TDD_CLSPRC==\"-\",NXTDD_BAS_PRC,TDD_CLSPRC))) %>% \n  drop_na(PRICE) %>% \n  select(BAS_DD,ISU_NM,PRICE,ACC_TRDVOL) %>% \n  separate(ISU_NM, into=c(\"PROD\",\"RGHT\",\"EXP\",\"EXER_PRC\"), sep=' ') %>%\n  mutate(EXER_PRC=as.double(EXER_PRC),\n         EXPMM=if_else(PROD==\"코스피200\",substr(EXP,3,6),substr(EXP,1,4)),\n         EXPWW=if_else(PROD==\"코스피200\",2,as.integer(substr(EXP,6,6)))) %>% \n  filter(EXER_PRC>min(idx_raw$KOSPI200)*0.85,\n         EXER_PRC<max(idx_raw$KOSPI200)*1.15,\n         PROD!=\"코스피위클리M\") %>% # 월요일 만기 위클리옵션 제외\n  mutate(PRIOR=as.integer(EXPMM)*10+EXPWW) # 만기가 짧은 순으로 우선순위 부여\n\n# 2-2. 데이터 전처리 : 옵션 만기일 데이터 생성\ntarget_date <- options %>% \n  distinct(.,BAS_DD, PRIOR) %>% \n  arrange(PRIOR, desc(BAS_DD)) %>% \n  group_by(PRIOR) %>% \n  slice(1) %>% \n  ungroup() %>% \n  distinct(BAS_DD) %>% \n  arrange(desc(BAS_DD)) %>% \n  filter(BAS_DD<20250411)\n\n# 2-3. 데이터 전처리 : KRX 정보데이터시스템 K200 및 V-K200지수 전처리\nidx_data <- idx_raw %>%\n  arrange(BAS_DD) %>% \n  mutate(LAG_K200=lag(KOSPI200),\n         LAG_VK200=lag(VKOSPI200))\n\nK200_portfolio=idx_data %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  mutate(RATE=(KOSPI200-LAG_K200)/LAG_K200,\n         YEAR = substr(BAS_DD, 1, 4),\n         YM = ym(substr(BAS_DD, 1, 6))) %>%\n  group_by(YEAR) %>%\n  filter(is.na(RATE)==FALSE) %>% \n  summarise(RATE_K200 = prod(1 + RATE),\n            MMF = mean(MMF)/100,\n            .groups = \"drop\") %>%\n  ungroup()\n\n# 3-1. 포트폴리오 구성 : VW양매도 포트폴리오 기초정보 생성\ntarget_info <- target_date %>% \n  left_join(options, by=\"BAS_DD\") %>% \n  distinct(BAS_DD,PRIOR) %>% \n  arrange(desc(BAS_DD),PRIOR) %>% \n  group_by(BAS_DD) %>% \n  # 만기가 도래하는 옵션을 제외하고 우선순위가 높은 옵션 선택\n  slice(2) %>% \n  ungroup() %>% \n  arrange(desc(BAS_DD)) %>% \n  left_join(idx_data, by=\"BAS_DD\") %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  # 옵션 보유기간 및 단기금리(MMF) 계산\n  mutate(DIFF_DAY=as.integer(ymd(lag(BAS_DD))-ymd(BAS_DD)),\n         MMF=MMF*0.01) %>% \n  # 옵션 보유기간에 해당하는 시장기대변동성 계산(V-K200활용)\n  mutate(VOL=LAG_VK200*sqrt(DIFF_DAY)/sqrt(365)/100) %>%\n  # 변동성에 따른 옵션 행사가격 상단(2.5단위 올림) 및 하단(2.5단위 내림) 계산\n  mutate(TARGET_C_K=ceiling(KOSPI200*(1+VOL)*0.4)/0.4,\n         TARGET_P_K=floor(KOSPI200*(1-VOL)*0.4)/0.4) %>% \n  # drop_na(DIFF_DAY) %>% \n  select(BAS_DD,VOL,DIFF_DAY,MMF,KOSPI200,LAG_VK200,PRIOR,TARGET_C_K,TARGET_P_K)\n\n# 3-2. 포트폴리오 구성 : VW양매도 포트폴리오 거래대상 옵션 정보 생성\ntarget_options <- target_info %>% \n  select(BAS_DD, PRIOR, TARGET_C_K, TARGET_P_K) %>% \n  pivot_longer(cols=c(\"TARGET_C_K\",\"TARGET_P_K\"),names_to = \"GRP\", values_to = \"EXER_PRC\") %>% \n  mutate(RGHT=substr(GRP,8,8)) %>% \n  left_join(options,by=c(\"BAS_DD\",\"PRIOR\",\"RGHT\",\"EXER_PRC\")) %>%\n  select(BAS_DD,GRP,PRICE,ACC_TRDVOL) %>% \n  pivot_wider(names_from = \"GRP\", values_from = c(\"PRICE\",\"ACC_TRDVOL\"))\n\n# 원금 100억원 가정\ncash = 10000*10000*100\n\n# 4. 포트폴리오 구현 : VW양매도 전략을 구현하여 일자별 손익 계산\nportfolio <- target_info %>% \n  left_join(target_options,by=\"BAS_DD\") %>% \n  arrange(BAS_DD) %>% \n  # 원금에 따른 옵션 매도수량 계산\n  mutate(SELL_AMT=cash/250000/KOSPI200) %>% \n  # 옵션 프리미엄(매도수익)) 계산\n  mutate(PREMIUM=SELL_AMT*(PRICE_TARGET_C_K+PRICE_TARGET_P_K)*250000) %>% \n  # 원금 및 프리미엄의 MMF 이자수익 및 권리행사손실 계산\n  mutate(INTEREST=(cash+replace_na(PREMIUM,0))*MMF*DIFF_DAY/365,\n         EXERCISE=(if_else(lead(KOSPI200)-TARGET_C_K>0,lead(KOSPI200)-TARGET_C_K,0)+\n                     if_else(TARGET_P_K-lead(KOSPI200)>0,TARGET_P_K-lead(KOSPI200),0))*250000*SELL_AMT) %>% \n  # 주단위 포트폴리오 손익 계산(원금 100억 가정, 당일 투자시 다음주 실현손익을 의미)\n  mutate(REVENUE=PREMIUM+INTEREST-EXERCISE) %>% \n  # 거래대상 옵션이 상장되어있지 않은 경우, MMF수익만 고려\n  mutate(REVENUE=if_else(is.na(REVENUE),INTEREST,REVENUE)) %>% \n  mutate(RATE=REVENUE/cash,\n         Group=\"Vol-adj. Weekly\")  # 주단위 포트폴리오 수익률\n\n# 5. 비교군 포트폴리오 생성 : 월별 5% OTM 양매도 전략\noptions2 <- options %>% \n  filter(PROD==\"코스피200\")\n\n# 옵션 만기일(매달) 생성\ntarget_date2 <- options2 %>% \n  distinct(.,BAS_DD, PRIOR) %>% \n  arrange(PRIOR, desc(BAS_DD)) %>% \n  group_by(PRIOR) %>% \n  slice(1) %>% \n  ungroup() %>% \n  distinct(BAS_DD) %>% \n  arrange(desc(BAS_DD)) %>% \n  filter(BAS_DD<20250411)\n\n# 일반 양매도 포트폴리오 기본 정보 생성\ntarget_info2 <- target_date2 %>% \n  left_join(options2, by=\"BAS_DD\") %>% \n  distinct(BAS_DD,PRIOR) %>% \n  arrange(desc(BAS_DD),PRIOR) %>% \n  group_by(BAS_DD) %>% \n  # 만기가 도래하는 옵션을 제외하고 우선순위가 높은 옵션 선택\n  slice(2) %>% \n  ungroup() %>% \n  arrange(desc(BAS_DD)) %>% \n  left_join(idx_data, by=\"BAS_DD\") %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  # 옵션 보유기간 및 단기금리(MMF) 계산\n  mutate(DIFF_DAY=as.integer(ymd(lag(BAS_DD))-ymd(BAS_DD)),\n         MMF=MMF*0.01,\n         VOL=0.05) %>%\n  # 변동성에 따른 옵션 행사가격 상단(2.5단위 올림) 및 하단(2.5단위 내림) 계산\n  mutate(TARGET_C_K=ceiling(KOSPI200*(1+VOL)*0.4)/0.4,\n         TARGET_P_K=floor(KOSPI200*(1-VOL)*0.4)/0.4) %>% \n  mutate(DIFF_DAY=if_else(is.na(DIFF_DAY),28,DIFF_DAY)) %>% \n  select(BAS_DD,VOL,DIFF_DAY,MMF,KOSPI200,LAG_VK200,PRIOR,TARGET_C_K,TARGET_P_K)\n\n# 일반 양매도 포트폴리오 거래대상 옵션\ntarget_options2 <- target_info2 %>% \n  select(BAS_DD, PRIOR, TARGET_C_K, TARGET_P_K) %>% \n  pivot_longer(cols=c(\"TARGET_C_K\",\"TARGET_P_K\"),names_to = \"GRP\", values_to = \"EXER_PRC\") %>% \n  mutate(RGHT=substr(GRP,8,8)) %>% \n  left_join(options2,by=c(\"BAS_DD\",\"PRIOR\",\"RGHT\",\"EXER_PRC\")) %>%\n  select(BAS_DD,GRP,PRICE,ACC_TRDVOL) %>% \n  pivot_wider(names_from = \"GRP\", values_from = c(\"PRICE\",\"ACC_TRDVOL\"))\n\n# 일반 양매도 포트폴리오 구현\nportfolio2 <- target_info2 %>% \n  left_join(target_options2,by=\"BAS_DD\") %>% \n  arrange(BAS_DD) %>% \n  # 원금에 따른 옵션 매도수량 계산\n  mutate(SELL_AMT=cash/250000/KOSPI200) %>% \n  # 옵션 프리미엄(매도수익)) 계산\n  mutate(PREMIUM=SELL_AMT*(PRICE_TARGET_C_K+PRICE_TARGET_P_K)*250000) %>% \n  # 원금 및 프리미엄의 MMF 이자수익 및 권리행사손실 계산\n  mutate(INTEREST=(cash+replace_na(PREMIUM,0))*MMF*DIFF_DAY/365,\n         EXERCISE=(if_else(lead(KOSPI200)-TARGET_C_K>0,lead(KOSPI200)-TARGET_C_K,0)+\n                     if_else(TARGET_P_K-lead(KOSPI200)>0,TARGET_P_K-lead(KOSPI200),0))*250000*SELL_AMT) %>% \n  mutate(EXERCISE=if_else(is.na(EXERCISE),0,EXERCISE)) %>% \n  # 주단위 포트폴리오 손익 계산(원금 100억 가정, 당일 투자시 다음주 실현손익을 의미)\n  mutate(REVENUE=PREMIUM+INTEREST-EXERCISE) %>% \n  # 거래대상 옵션이 상장되어있지 않은 경우, MMF수익만 고려\n  mutate(REVENUE=if_else(is.na(REVENUE),INTEREST,REVENUE)) %>% \n  mutate(RATE=REVENUE/cash,\n         Group=\"Monthly\") # 주단위 포트폴리오 수익률\n\nportfolio <- portfolio %>% filter(BAS_DD!=20250410)\nportfolio2 <- portfolio2 %>% filter(BAS_DD!=20250410)\nportfolio3 <- portfolio %>% \n  summarise(across(where(is.numeric), sum)) %>% \n  mutate(Group=\"Vol-adj. Weekly Sum\")\n  \n\n# 요약표 4 : 검증 자료\ntable4 <- portfolio %>%\n  union_all(portfolio2) %>%\n  union_all(portfolio3) %>% \n  group_by(BAS_DD, Group) %>%\n  summarise(Premium = round(mean(PREMIUM)/10000,0),\n            Interest = round(mean(INTEREST)/10000,0),\n            Loss = round(mean(EXERCISE)/10000,0),\n            Revenue = round(mean(REVENUE)/10000,0),\n            Return = round(prod(1 + RATE)-1,2),\n            .groups = \"drop\")\n\n# 그래프 4 : 검증기간중 코스피200지수 추이\ngraph4 <- ggplot(idx_raw, aes(x = ymd(BAS_DD))) +\n  geom_line(aes(y = KOSPI200, color = \"KOSPI200\"), size = 1.2) +\n  geom_line(aes(y = (VKOSPI200 - 19) / 26 * 60 + 300, color = \"VKOSPI200\"), size = 1.2) +\n  geom_vline(xintercept = ymd(c(\"20250313\", \"20250320\", \"20250327\", \"20250403\",\"20250410\")),\n             linetype = \"dotted\", color = \"grey40\") +\n  scale_y_continuous(name = \"KOSPI200\",limits = c(300, 360),\n                     sec.axis = sec_axis(\n                       ~ (.-300) / 60 * 26 + 19, name = \"VKOSPI200\")) +\n  scale_color_manual(values = c(\"KOSPI200\" = \"blue\", \"VKOSPI200\" = \"red\"),\n                     guide = guide_legend(direction = \"horizontal\")) +\n  labs(title = \"Kospi200 & V-Kospi200 indices\",x = NULL,color = NULL) +\n  theme_minimal() +\n  scale_x_date(date_breaks = \"3 days\", date_labels = \"%m-%d\") +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1),\n        legend.position = c(0.5, 0.95))\n```\n\n***표4 : 검증기간('25.3.13 ~ 4.10) VW양매도 및 일반 양매도 전략 성과***\n\n```{r}\n#| echo: false\n#| warning: false\nkable(table4)\n```\n\n**검증기간 중 VW양매도 전략은 옵션을 4회 매도하였고, 일반 양매도는 1회 매도**하였습니다.\n\nVW양매도 전략의 **프리미엄이 4회 발생하면서 수익성은 개선**되었지만, 세번째 매도시기에 **큰 손실이 발생하면서 순이익이 악화**되었습니다. 벡테스팅 결과와 비교할 때 **상반된 결과**입니다.\n\n그 **원인은 최근 트럼프 행정부의 관세 부과 정책의 영향**으로, 증시가 이례적으로 급등락한 데에서 찾을 수 있었습니다.\n\n\\newpage\n\n***그래프5 : 검증기간('25.3.13 ~ 4.10) Kospi200 및 V-Kospi200 지수 추이***\n```{r}\n#| echo: false\n#| warning: false\ngraph4\n```\n\n먼저, **3.27일 예상변동성(V-K200)이 낮아 행사가격 범위가 좁게 형성**되어 VW양매도 전략이 실행되었고, 이후 관세 정책 영향으로 지수가 급락하면서 **큰 손실이 발생**하게 되었습니다.\n\n반면 **월별 전략은 만기 직전에 관세가 연기**되면서 **증시가 회복**하였고(304 > 325), 손실을 피하게 되었습니다. \n\n다소 아쉬운 결과이나, **VW양매도 전략의 한계점과 특수한 상황에서는 오히려 불리하다는 점**을 알 수 있었습니다.\n\n1. VW양매도 전략은 **시장 변동성이 적절히 반영되지 않을 가능성**이 있고, 이 경우 예기치 못한 손실이 발생할 수 있음\n2. **옵션 만기가 짧은 것은 일반적**으로 수익성, 유동성 등에서 **장점**이 있으나, **증시가 급락 후 회복하는 상황에서는 만기가 긴 옵션이 유리**할 수 있음\n\n\\newpage\n\n## 5. Appendix : Python, R code\n\n### Pyhon code : 데이터 수집 및 전처리\n\n```{python}\n#| echo: true\n#| eval: false\nimport requests\nimport json\nimport pandas as pd\nimport aiohttp\nimport asyncio\n\n# KRX OpenAPI 예시\nurl = 'http://data-dbg.krx.co.kr/svc/sample/apis/drv/opt_bydd_trd?basDd=20250312'\nheaders = {'AUTH_KEY': '74D1B99DFBF345BBA3FB4476510A4BED4C78D13A'}\nres = requests.get(url=url, headers=headers)\nres.text\n\n# KRX OpenAPI를 이용한 옵션 데이터 수집 (네트워크 병렬 처리)\nidx_data = pd.read_csv('data/idx_data.csv')\nurl = 'http://data-dbg.krx.co.kr/svc/apis/drv/opt_bydd_trd?basDd='\nkey = 'BDFA640BBCE84C4B8A465EA024D50D6F3FD909FF'\n\nasync def fetch(session, url, bas_dd):\n    async with session.get(url + bas_dd, headers={'AUTH_KEY': key}) as response:\n        return await response.json()\n\nasync def fetch_all(bas_dd_list, url):\n    async with aiohttp.ClientSession() as session:\n        tasks = [fetch(session, url, str(bas_dd)) for bas_dd in bas_dd_list]\n        return await asyncio.gather(*tasks)\n\nasync def main():\n    bas_dd_list = idx_data['BAS_DD'].astype(str).tolist()\n    responses = await fetch_all(bas_dd_list, url)\n\n    data_list = [pd.json_normalize(res['OutBlock_1']) for res in responses if 'OutBlock_1' in res and res['OutBlock_1']]\n    options = pd.concat(data_list, axis=0, ignore_index=True)\n\n    # CSV 저장\n    options.to_csv(\"options_data.csv\", encoding=\"utf-8-sig\", index=False)\n    print(\"complete\")\n```\n\n### R code 1 : 데이터 가공, Backtesting\n\n```{r}\n#| echo: true\n#| eval: false\n#| warning: false\n#| error: false\n\nrm(list=ls())\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(patchwork)\n\n# 1. 원본데이터 준비\noptions_raw <- read_csv(\"data/options_data.csv\") %>% tibble()\nidx_raw <- read_csv(\"data/idx_data.csv\") %>% tibble()\nmmf_raw <- read_csv(\"data/mmf.csv\") %>% tibble()\n\n# 2-1. 데이터 전처리 : KRX openAPI 옵션데이터 전처리\noptions <- options_raw %>% \n  # K200, WK200 이외의 옵션 제외\n  filter(substr(PROD_NM,1,3)==\"코스피\") %>%\n  # 종가가 없는 경우 익일 기준가격(이론가격) 사용\n  mutate(PRICE = as.double(if_else(TDD_CLSPRC==\"-\",NXTDD_BAS_PRC,TDD_CLSPRC))) %>% \n  drop_na(PRICE) %>% \n  select(BAS_DD,ISU_NM,PRICE,ACC_TRDVOL) %>% \n  separate(ISU_NM, into=c(\"PROD\",\"RGHT\",\"EXP\",\"EXER_PRC\"), sep=' ') %>%\n  mutate(EXER_PRC=as.double(EXER_PRC),\n         EXPMM=if_else(PROD==\"코스피200\",substr(EXP,3,6),substr(EXP,1,4)),\n         EXPWW=if_else(PROD==\"코스피200\",2,as.integer(substr(EXP,6,6)))) %>% \n  filter(EXER_PRC>min(idx_raw$KOSPI200)*0.85,\n         EXER_PRC<max(idx_raw$KOSPI200)*1.15,\n         PROD!=\"코스피위클리M\") %>% # 월요일 만기 위클리옵션 제외\n  mutate(PRIOR=as.integer(EXPMM)*10+EXPWW) # 만기가 짧은 순으로 우선순위 부여\n\n# 2-2. 데이터 전처리 : 옵션 만기일 데이터 생성\ntarget_date <- options %>% \n  distinct(.,BAS_DD, PRIOR) %>% \n  arrange(PRIOR, desc(BAS_DD)) %>% \n  group_by(PRIOR) %>% \n  slice(1) %>% \n  ungroup() %>% \n  distinct(BAS_DD) %>% \n  arrange(desc(BAS_DD)) %>% \n  filter(BAS_DD<20241231, BAS_DD>20200101)\n\n# 2-3. 데이터 전처리 : KRX 정보데이터시스템 K200 및 V-K200지수 전처리\nidx_data <- idx_raw %>%\n  arrange(BAS_DD) %>% \n  mutate(LAG_K200=lag(KOSPI200),\n         LAG_VK200=lag(VKOSPI200))\n\nK200_portfolio=idx_data %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  mutate(RATE=(KOSPI200-LAG_K200)/LAG_K200,\n         YEAR = substr(BAS_DD, 1, 4),\n         YM = ym(substr(BAS_DD, 1, 6))) %>%\n  group_by(YEAR, YM) %>%\n  summarise(RATE_K200 = if_else(is.na(prod(1 + RATE)),0,prod(1 + RATE)),\n            MMF = mean(MMF)/100,\n            .groups = \"drop\") %>%\n  ungroup()\n\n# 3-1. 포트폴리오 구성 : VW양매도 포트폴리오 기초정보 생성\ntarget_info <- target_date %>% \n  left_join(options, by=\"BAS_DD\") %>% \n  distinct(BAS_DD,PRIOR) %>% \n  arrange(desc(BAS_DD),PRIOR) %>% \n  group_by(BAS_DD) %>% \n  # 만기가 도래하는 옵션을 제외하고 우선순위가 높은 옵션 선택\n  slice(2) %>% \n  ungroup() %>% \n  arrange(desc(BAS_DD)) %>% \n  left_join(idx_data, by=\"BAS_DD\") %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  # 옵션 보유기간 및 단기금리(MMF) 계산\n  mutate(DIFF_DAY=as.integer(ymd(lag(BAS_DD))-ymd(BAS_DD)),\n         MMF=MMF*0.01) %>% \n  # 옵션 보유기간에 해당하는 시장기대변동성 계산(V-K200활용)\n  mutate(VOL=LAG_VK200*sqrt(DIFF_DAY)/sqrt(365)/100) %>%\n  # 변동성에 따른 옵션 행사가격 상단(2.5단위 올림) 및 하단(2.5단위 내림) 계산\n  mutate(TARGET_C_K=ceiling(KOSPI200*(1+VOL)*0.4)/0.4,\n         TARGET_P_K=floor(KOSPI200*(1-VOL)*0.4)/0.4) %>% \n  drop_na(DIFF_DAY) %>% \n  select(BAS_DD,VOL,DIFF_DAY,MMF,KOSPI200,LAG_VK200,PRIOR,TARGET_C_K,TARGET_P_K)\n\n# 3-2. 포트폴리오 구성 : VW양매도 포트폴리오 거래대상 옵션 정보 생성\ntarget_options <- target_info %>% \n  select(BAS_DD, PRIOR, TARGET_C_K, TARGET_P_K) %>% \n  pivot_longer(cols=c(\"TARGET_C_K\",\"TARGET_P_K\"),names_to = \"GRP\", values_to = \"EXER_PRC\") %>% \n  mutate(RGHT=substr(GRP,8,8)) %>% \n  left_join(options,by=c(\"BAS_DD\",\"PRIOR\",\"RGHT\",\"EXER_PRC\")) %>%\n  select(BAS_DD,GRP,PRICE,ACC_TRDVOL) %>% \n  pivot_wider(names_from = \"GRP\", values_from = c(\"PRICE\",\"ACC_TRDVOL\"))\n\n# 원금 100억원 가정\ncash = 10000*10000*100\n\n# 4. 포트폴리오 구현 : VW양매도 전략을 구현하여 일자별 손익 계산\nportfolio <- target_info %>% \n  left_join(target_options,by=\"BAS_DD\") %>% \n  arrange(BAS_DD) %>% \n  # 원금에 따른 옵션 매도수량 계산\n  mutate(SELL_AMT=cash/250000/KOSPI200) %>% \n  # 옵션 프리미엄(매도수익)) 계산\n  mutate(PREMIUM=SELL_AMT*(PRICE_TARGET_C_K+PRICE_TARGET_P_K)*250000) %>% \n  # 원금 및 프리미엄의 MMF 이자수익 및 권리행사손실 계산\n  mutate(INTEREST=(cash+replace_na(PREMIUM,0))*MMF*DIFF_DAY/365,\n         EXERCISE=(if_else(lead(KOSPI200)-TARGET_C_K>0,lead(KOSPI200)-TARGET_C_K,0)+\n                     if_else(TARGET_P_K-lead(KOSPI200)>0,TARGET_P_K-lead(KOSPI200),0))*250000*SELL_AMT) %>% \n  # 주단위 포트폴리오 손익 계산(원금 100억 가정, 당일 투자시 다음주 실현손익을 의미)\n  mutate(REVENUE=PREMIUM+INTEREST-EXERCISE) %>% \n  # 거래대상 옵션이 상장되어있지 않은 경우, MMF수익만 고려\n  mutate(REVENUE=if_else(is.na(REVENUE),INTEREST,REVENUE)) %>% \n  mutate(RATE=REVENUE/cash)  # 주단위 포트폴리오 수익률\n\n# 5. 비교군 포트폴리오 생성 : 월별 5% OTM 양매도 전략\noptions2 <- options %>% \n  filter(PROD==\"코스피200\")\n\n# 옵션 만기일(매달) 생성\ntarget_date2 <- options2 %>% \n  distinct(.,BAS_DD, PRIOR) %>% \n  arrange(PRIOR, desc(BAS_DD)) %>% \n  group_by(PRIOR) %>% \n  slice(1) %>% \n  ungroup() %>% \n  distinct(BAS_DD) %>% \n  arrange(desc(BAS_DD)) %>% \n  filter(BAS_DD<20241231, BAS_DD>20200101)\n\n# 일반 양매도 포트폴리오 기본 정보 생성\ntarget_info2 <- target_date2 %>% \n  left_join(options2, by=\"BAS_DD\") %>% \n  distinct(BAS_DD,PRIOR) %>% \n  arrange(desc(BAS_DD),PRIOR) %>% \n  group_by(BAS_DD) %>% \n  # 만기가 도래하는 옵션을 제외하고 우선순위가 높은 옵션 선택\n  slice(2) %>% \n  ungroup() %>% \n  arrange(desc(BAS_DD)) %>% \n  left_join(idx_data, by=\"BAS_DD\") %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  # 옵션 보유기간 및 단기금리(MMF) 계산\n  mutate(DIFF_DAY=as.integer(ymd(lag(BAS_DD))-ymd(BAS_DD)),\n         MMF=MMF*0.01,\n         VOL=0.05) %>%\n  # 변동성에 따른 옵션 행사가격 상단(2.5단위 올림) 및 하단(2.5단위 내림) 계산\n  mutate(TARGET_C_K=ceiling(KOSPI200*(1+VOL)*0.4)/0.4,\n         TARGET_P_K=floor(KOSPI200*(1-VOL)*0.4)/0.4) %>% \n  mutate(DIFF_DAY=if_else(is.na(DIFF_DAY),28,DIFF_DAY)) %>% \n  select(BAS_DD,VOL,DIFF_DAY,MMF,KOSPI200,LAG_VK200,PRIOR,TARGET_C_K,TARGET_P_K)\n\n# 일반 양매도 포트폴리오 거래대상 옵션\ntarget_options2 <- target_info2 %>% \n  select(BAS_DD, PRIOR, TARGET_C_K, TARGET_P_K) %>% \n  pivot_longer(cols=c(\"TARGET_C_K\",\"TARGET_P_K\"),names_to = \"GRP\", values_to = \"EXER_PRC\") %>% \n  mutate(RGHT=substr(GRP,8,8)) %>% \n  left_join(options2,by=c(\"BAS_DD\",\"PRIOR\",\"RGHT\",\"EXER_PRC\")) %>%\n  select(BAS_DD,GRP,PRICE,ACC_TRDVOL) %>% \n  pivot_wider(names_from = \"GRP\", values_from = c(\"PRICE\",\"ACC_TRDVOL\"))\n\n# 일반 양매도 포트폴리오 구현\nportfolio2 <- target_info2 %>% \n  left_join(target_options2,by=\"BAS_DD\") %>% \n  arrange(BAS_DD) %>% \n  # 원금에 따른 옵션 매도수량 계산\n  mutate(SELL_AMT=cash/250000/KOSPI200) %>% \n  # 옵션 프리미엄(매도수익)) 계산\n  mutate(PREMIUM=SELL_AMT*(PRICE_TARGET_C_K+PRICE_TARGET_P_K)*250000) %>% \n  # 원금 및 프리미엄의 MMF 이자수익 및 권리행사손실 계산\n  mutate(INTEREST=(cash+replace_na(PREMIUM,0))*MMF*DIFF_DAY/365,\n         EXERCISE=(if_else(lead(KOSPI200)-TARGET_C_K>0,lead(KOSPI200)-TARGET_C_K,0)+\n                     if_else(TARGET_P_K-lead(KOSPI200)>0,TARGET_P_K-lead(KOSPI200),0))*250000*SELL_AMT) %>% \n  mutate(EXERCISE=if_else(is.na(EXERCISE),0,EXERCISE)) %>% \n  # 주단위 포트폴리오 손익 계산(원금 100억 가정, 당일 투자시 다음주 실현손익을 의미)\n  mutate(REVENUE=PREMIUM+INTEREST-EXERCISE) %>% \n  # 거래대상 옵션이 상장되어있지 않은 경우, MMF수익만 고려\n  mutate(REVENUE=if_else(is.na(REVENUE),INTEREST,REVENUE)) %>% \n  mutate(RATE=REVENUE/cash) # 주단위 포트폴리오 수익률\n\n# 6. 성과분석 : VW양매도 포트폴리오\nperformance <- portfolio %>%\n  drop_na(PREMIUM, EXERCISE) %>%\n  mutate(YEAR = substr(BAS_DD, 1, 4),\n         YM = ym(substr(BAS_DD, 1, 6))) %>%\n  group_by(YEAR, YM) %>%\n  summarise(PREMIUM = sum(PREMIUM),\n            INTEREST = sum(INTEREST),\n            EXERCISE = sum(EXERCISE),\n            REVENUE = sum(REVENUE),\n            RATE = prod(1 + RATE),\n            .groups = \"drop\") %>%\n  ungroup()\n\n# 6. 성과분석 : 일반 양매도 포트폴리오\nperformance2 <- portfolio2 %>%\n  drop_na(PREMIUM, EXERCISE) %>%\n  mutate(YEAR = substr(BAS_DD, 1, 4),\n         YM = ym(substr(BAS_DD, 1, 6))) %>%\n  group_by(YEAR, YM) %>%\n  summarise(PREMIUM = sum(PREMIUM),\n            INTEREST = sum(INTEREST),\n            EXERCISE = sum(EXERCISE),\n            REVENUE = sum(REVENUE),\n            RATE = prod(1 + RATE),\n            .groups = \"drop\") %>%\n  ungroup()\n\n# 시각화 등\ngraph1_1 <- performance %>%\n  arrange(YM) %>%\n  left_join(K200_portfolio,by=c(\"YEAR\",\"YM\")) %>% \n  mutate(CUM_RATE = cumprod(RATE) * 100 - 100,\n         CUM_RATE_K200 = cumprod(RATE_K200) * 100 - 100) %>% \n  bind_rows(tibble(YM=ym(201912),CUM_RATE=0,CUM_RATE_K200=0))\n  \n\ngraph1_2 <- performance2 %>%\n  arrange(YM) %>%\n  left_join(K200_portfolio,by=c(\"YEAR\",\"YM\")) %>% \n  mutate(CUM_RATE = cumprod(RATE) * 100 - 100,\n         CUM_RATE_K200 = cumprod(RATE_K200) * 100 - 100) %>% \n  bind_rows(tibble(YM=ym(201912),CUM_RATE=0,CUM_RATE_K200=0))\n\ngraph1_3 <- graph1_1 %>%\n  inner_join(graph1_2, by = \"YM\", suffix = c(\"_1\", \"_2\")) %>%\n  mutate(REVENUE_DIFF = (REVENUE_1 - REVENUE_2) / 1e8)\n\ngraph2_1 <- performance %>%\n  arrange(YM) %>%\n  left_join(K200_portfolio,by=c(\"YEAR\",\"YM\")) %>% \n  filter(as.integer(YEAR) > 2021) %>%\n  mutate(CUM_RATE = cumprod(RATE) * 100 - 100,\n         CUM_RATE_K200 = cumprod(RATE_K200) * 100 - 100) %>% \n  bind_rows(tibble(YM=ym(202112),CUM_RATE=0,CUM_RATE_K200=0))\n\ngraph2_2 <- performance2 %>%\n  arrange(YM) %>%\n  left_join(K200_portfolio,by=c(\"YEAR\",\"YM\")) %>% \n  filter(as.integer(YEAR) > 2021) %>%\n  mutate(CUM_RATE = cumprod(RATE) * 100 - 100,\n         CUM_RATE_K200 = cumprod(RATE_K200) * 100 - 100) %>% \n  bind_rows(tibble(YM=ym(202112),CUM_RATE=0,CUM_RATE_K200=0))\n\ngraph2_3 <- graph2_1 %>%\n  inner_join(graph2_2, by = \"YM\", suffix = c(\"_1\", \"_2\")) %>%\n  mutate(REVENUE_DIFF = (REVENUE_1 - REVENUE_2) / 1e8)\n\ngraph3_1 <- portfolio %>%\n  mutate(YM = ym(substr(BAS_DD, 1, 6))) %>%\n  group_by(YM) %>%\n  summarise(TargetVol=mean(VOL),\n            Kospi200=mean(KOSPI200)) %>% ungroup()\n\ngraph1=ggplot() +\n  geom_line(data = graph1_1, aes(x = YM, y = CUM_RATE, color = \"Vol-adj. Weekly\"), size = 1) +\n  geom_point(data = graph1_1, aes(x = YM, y = CUM_RATE, color = \"Vol-adj. Weekly\"), shape = 16, size = 2) +\n  geom_line(data = graph1_2, aes(x = YM, y = CUM_RATE, color = \"5% OTM Monthly\"), size = 1) +\n  geom_point(data = graph1_2, aes(x = YM, y = CUM_RATE, color = \"5% OTM Monthly\"), shape = 16, size = 2) +\n  geom_line(data = graph1_1, aes(x = YM, y = CUM_RATE_K200, color = \"Kospi 200\"), size = 1, alpha=0.7) +\n  geom_point(data = graph1_1, aes(x = YM, y = CUM_RATE_K200, color = \"Kospi 200\"), shape = 16, size = 2,alpha=0.7) +\n  geom_bar(data = graph1_3, aes(x = YM, y = REVENUE_DIFF * 3),\n           stat = \"identity\", alpha = 0.5, fill = \"gray\") +\n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +\n  scale_y_continuous(limits = c(-30, 50), breaks = seq(-30, 50, 10), labels = scales::number_format(accuracy = 0.1),\n                     sec.axis = sec_axis(~ . / 3, name = \"Overperform (100M)\", breaks = c(-10, -5, 0, 5, 10), labels = c(\"-10\", \"-5\", \"0\", \"5\", \"10\"))) +\n  scale_color_manual(values = c(\"Vol-adj. Weekly\" = \"red\", \"5% OTM Monthly\" = \"blue\", \"Kospi 200\" = \"Green\")) +\n  labs(x = NULL, y = \"Cumulative Return (%)\", color = \"\") +\n  theme_minimal() +\n  theme(legend.position = c(0.4, 0.93), legend.direction = \"horizontal\")\n\ngraph2=ggplot() +\n  geom_line(data = graph2_1, aes(x = YM, y = CUM_RATE, color = \"Vol-adj. Weekly\"), size = 1) +\n  geom_point(data = graph2_1, aes(x = YM, y = CUM_RATE, color = \"Vol-adj. Weekly\"), shape = 16, size = 2) +\n  geom_line(data = graph2_2, aes(x = YM, y = CUM_RATE, color = \"5% OTM Monthly\"), size = 1) +\n  geom_point(data = graph2_2, aes(x = YM, y = CUM_RATE, color = \"5% OTM Monthly\"), shape = 16, size = 2) +\n  geom_line(data = graph2_1, aes(x = YM, y = CUM_RATE_K200, color = \"Kospi 200\"), size = 1, alpha=0.7) +\n  geom_point(data = graph2_1, aes(x = YM, y = CUM_RATE_K200, color = \"Kospi 200\"), shape = 16, size = 2,alpha=0.7) +\n  geom_bar(data = graph2_3, aes(x = YM, y = REVENUE_DIFF * 3),\n           stat = \"identity\", alpha = 0.5, fill = \"gray\") +\n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +\n  scale_y_continuous(limits = c(-30, 20), breaks = seq(-30, 30, 10), labels = scales::number_format(accuracy = 0.1),\n                     sec.axis = sec_axis(~ . / 3, name = \"Overperform (100M)\", breaks = c(-10, -5, 0, 5, 10), labels = c(\"-10\", \"-5\", \"0\", \"5\", \"10\"))) +\n  scale_color_manual(values = c(\"Vol-adj. Weekly\" = \"red\", \"5% OTM Monthly\" = \"blue\", \"Kospi 200\" = \"Green\")) +\n  labs(x = NULL, y = \"Cumulative Return (%)\", color = \"\") +\n  theme_minimal() +\n  theme(legend.position = c(0.4, 0.93), legend.direction = \"horizontal\")\n\ngraph3=ggplot() +\n  geom_line(data = graph3_1, aes(x = YM, y = Kospi200, color = \"Kospi 200\"), size = 1) +\n  geom_point(data = graph3_1, aes(x = YM, y = Kospi200, color = \"Kospi 200\"), shape = 16, size = 2) +\n  geom_bar(data = graph3_1, aes(x = YM, y = TargetVol * 7000),\n           stat = \"identity\", alpha = 0.7, fill = \"blue\") +\n  geom_hline(yintercept = 200, size=0.5, color = \"black\", alpha=0.5)+\n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +\n  scale_y_continuous(limits = c(0, 500), breaks = seq(100, 500, 100),\n                     sec.axis = sec_axis(~ . / 7000, name = \"Strike Range(Monthly)\", breaks = c(0, 0.025,0.05,0.075, 0.1), labels = c(\"0\",\"5%\", \"10%\",\"15%\", \"20%\"))) +\n  scale_color_manual(values = c(\"Kospi 200\" = \"red\")) +\n  labs(x = NULL, y = \"Kospi 200\", color = \"\") +\n  theme_minimal() +\n  theme(legend.position = c(0.1, 0.93), legend.direction = \"horizontal\")\n\n# 요약표 1 : VW포트폴리오\ntable1 <- portfolio %>%\n  drop_na(PREMIUM, EXERCISE) %>%\n  mutate(YEAR = substr(BAS_DD, 1, 4),\n         CNT=1,\n         NO=if_else(EXERCISE==0,1,0)) %>%\n  group_by(YEAR) %>%\n  summarise(Expiry = sum(CNT),\n            NoExercise = round(sum(NO)/sum(CNT),2),\n            Premium = round(mean(PREMIUM)/10000,0),\n            Interest = round(mean(INTEREST)/10000,0),\n            Loss = round(mean(EXERCISE)/10000,0),\n            Revenue = round(mean(REVENUE)/10000,0),\n            Return = round(prod(1 + RATE)-1,2),\n            .groups = \"drop\") %>% \n  left_join(K200_portfolio %>% group_by(YEAR) %>% summarise(Return_K200=round(prod(RATE_K200)-1,2)),\n            by=\"YEAR\")\n\n# 요약표 2 : 일반 포트폴리오\ntable2 <- portfolio2 %>%\n  drop_na(PREMIUM, EXERCISE) %>%\n  mutate(YEAR = substr(BAS_DD, 1, 4),\n         CNT=1,\n         NO=if_else(EXERCISE==0,1,0)) %>%\n  group_by(YEAR) %>%\n  summarise(Expiry = sum(CNT),\n            NoExercise = round(sum(NO)/sum(CNT),2),\n            Premium = round(mean(PREMIUM)/10000,0),\n            Interest = round(mean(INTEREST)/10000,0),\n            Loss = round(mean(EXERCISE)/10000,0),\n            Revenue = round(mean(REVENUE)/10000,0),\n            Return = round(prod(1 + RATE)-1,2),\n            .groups = \"drop\") %>% \n  left_join(K200_portfolio %>% group_by(YEAR) %>% summarise(Return_K200=round(prod(RATE_K200)-1,2)),\n            by=\"YEAR\")\n\n# 요약표 3 : 포트폴리오 변동성 비교\nVol1 <- graph1_1 %>% group_by(YEAR) %>% summarise(Vol=round(sd(RATE)*sqrt(12),2),\n                                                  Vol_K200=round(sd(RATE_K200)*sqrt(12),2))\nVol2 <- graph1_2 %>% group_by(YEAR) %>% summarise(Vol=round(sd(RATE)*sqrt(12),2))\n\ntable3 <- table1 %>% \n  select(YEAR,Return,Return_K200) %>% \n  left_join(Vol1, by=\"YEAR\") %>% \n  mutate(Return_main=Return,\n         Vol_main=Vol) %>% \n  select(YEAR, Return_main,Vol_main,Return_K200,Vol_K200) %>% \n  left_join(table2 %>% \n              select(YEAR,Return) %>% \n              left_join(Vol2, by=\"YEAR\") %>% \n              mutate(Return_sub=Return,\n                     Vol_sub=Vol) %>% \n              select(YEAR,Return_sub,Vol_sub), by=\"YEAR\")\n```\n\n### R code 2 : 전략 검증\n\n```{r}\n#| echo: true\n#| eval: false\n#| warning: false\n#| error: false\nrm(list=ls())\nlibrary(tidyverse)\nlibrary(knitr)\nlibrary(patchwork)\nsetwd(\"homepage/study_25spring/data/\")\n\n# 1. 원본데이터 준비\noptions_raw <- read_csv(\"options_data_test.csv\") %>% tibble()\nidx_raw <- read_csv(\"idx_data_test.csv\") %>% tibble()\nmmf_raw <- read_csv(\"mmf_test.csv\") %>% tibble()\n\n# 2-1. 데이터 전처리 : KRX openAPI 옵션데이터 전처리\noptions <- options_raw %>% \n  # K200, WK200 이외의 옵션 제외\n  filter(substr(PROD_NM,1,3)==\"코스피\") %>%\n  # 종가가 없는 경우 익일 기준가격(이론가격) 사용\n  mutate(PRICE = as.double(if_else(TDD_CLSPRC==\"-\",NXTDD_BAS_PRC,TDD_CLSPRC))) %>% \n  drop_na(PRICE) %>% \n  select(BAS_DD,ISU_NM,PRICE,ACC_TRDVOL) %>% \n  separate(ISU_NM, into=c(\"PROD\",\"RGHT\",\"EXP\",\"EXER_PRC\"), sep=' ') %>%\n  mutate(EXER_PRC=as.double(EXER_PRC),\n         EXPMM=if_else(PROD==\"코스피200\",substr(EXP,3,6),substr(EXP,1,4)),\n         EXPWW=if_else(PROD==\"코스피200\",2,as.integer(substr(EXP,6,6)))) %>% \n  filter(EXER_PRC>min(idx_raw$KOSPI200)*0.85,\n         EXER_PRC<max(idx_raw$KOSPI200)*1.15,\n         PROD!=\"코스피위클리M\") %>% # 월요일 만기 위클리옵션 제외\n  mutate(PRIOR=as.integer(EXPMM)*10+EXPWW) # 만기가 짧은 순으로 우선순위 부여\n\n# 2-2. 데이터 전처리 : 옵션 만기일 데이터 생성\ntarget_date <- options %>% \n  distinct(.,BAS_DD, PRIOR) %>% \n  arrange(PRIOR, desc(BAS_DD)) %>% \n  group_by(PRIOR) %>% \n  slice(1) %>% \n  ungroup() %>% \n  distinct(BAS_DD) %>% \n  arrange(desc(BAS_DD)) %>% \n  filter(BAS_DD<20250411)\n\n# 2-3. 데이터 전처리 : KRX 정보데이터시스템 K200 및 V-K200지수 전처리\nidx_data <- idx_raw %>%\n  arrange(BAS_DD) %>% \n  mutate(LAG_K200=lag(KOSPI200),\n         LAG_VK200=lag(VKOSPI200))\n\nK200_portfolio=idx_data %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  mutate(RATE=(KOSPI200-LAG_K200)/LAG_K200,\n         YEAR = substr(BAS_DD, 1, 4),\n         YM = ym(substr(BAS_DD, 1, 6))) %>%\n  group_by(YEAR) %>%\n  filter(is.na(RATE)==FALSE) %>% \n  summarise(RATE_K200 = prod(1 + RATE),\n            MMF = mean(MMF)/100,\n            .groups = \"drop\") %>%\n  ungroup()\n\n# 3-1. 포트폴리오 구성 : VW양매도 포트폴리오 기초정보 생성\ntarget_info <- target_date %>% \n  left_join(options, by=\"BAS_DD\") %>% \n  distinct(BAS_DD,PRIOR) %>% \n  arrange(desc(BAS_DD),PRIOR) %>% \n  group_by(BAS_DD) %>% \n  # 만기가 도래하는 옵션을 제외하고 우선순위가 높은 옵션 선택\n  slice(2) %>% \n  ungroup() %>% \n  arrange(desc(BAS_DD)) %>% \n  left_join(idx_data, by=\"BAS_DD\") %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  # 옵션 보유기간 및 단기금리(MMF) 계산\n  mutate(DIFF_DAY=as.integer(ymd(lag(BAS_DD))-ymd(BAS_DD)),\n         MMF=MMF*0.01) %>% \n  # 옵션 보유기간에 해당하는 시장기대변동성 계산(V-K200활용)\n  mutate(VOL=LAG_VK200*sqrt(DIFF_DAY)/sqrt(365)/100) %>%\n  # 변동성에 따른 옵션 행사가격 상단(2.5단위 올림) 및 하단(2.5단위 내림) 계산\n  mutate(TARGET_C_K=ceiling(KOSPI200*(1+VOL)*0.4)/0.4,\n         TARGET_P_K=floor(KOSPI200*(1-VOL)*0.4)/0.4) %>% \n  # drop_na(DIFF_DAY) %>% \n  select(BAS_DD,VOL,DIFF_DAY,MMF,KOSPI200,LAG_VK200,PRIOR,TARGET_C_K,TARGET_P_K)\n\n# 3-2. 포트폴리오 구성 : VW양매도 포트폴리오 거래대상 옵션 정보 생성\ntarget_options <- target_info %>% \n  select(BAS_DD, PRIOR, TARGET_C_K, TARGET_P_K) %>% \n  pivot_longer(cols=c(\"TARGET_C_K\",\"TARGET_P_K\"),names_to = \"GRP\", values_to = \"EXER_PRC\") %>% \n  mutate(RGHT=substr(GRP,8,8)) %>% \n  left_join(options,by=c(\"BAS_DD\",\"PRIOR\",\"RGHT\",\"EXER_PRC\")) %>%\n  select(BAS_DD,GRP,PRICE,ACC_TRDVOL) %>% \n  pivot_wider(names_from = \"GRP\", values_from = c(\"PRICE\",\"ACC_TRDVOL\"))\n\n# 원금 100억원 가정\ncash = 10000*10000*100\n\n# 4. 포트폴리오 구현 : VW양매도 전략을 구현하여 일자별 손익 계산\nportfolio <- target_info %>% \n  left_join(target_options,by=\"BAS_DD\") %>% \n  arrange(BAS_DD) %>% \n  # 원금에 따른 옵션 매도수량 계산\n  mutate(SELL_AMT=cash/250000/KOSPI200) %>% \n  # 옵션 프리미엄(매도수익)) 계산\n  mutate(PREMIUM=SELL_AMT*(PRICE_TARGET_C_K+PRICE_TARGET_P_K)*250000) %>% \n  # 원금 및 프리미엄의 MMF 이자수익 및 권리행사손실 계산\n  mutate(INTEREST=(cash+replace_na(PREMIUM,0))*MMF*DIFF_DAY/365,\n         EXERCISE=(if_else(lead(KOSPI200)-TARGET_C_K>0,lead(KOSPI200)-TARGET_C_K,0)+\n                     if_else(TARGET_P_K-lead(KOSPI200)>0,TARGET_P_K-lead(KOSPI200),0))*250000*SELL_AMT) %>% \n  # 주단위 포트폴리오 손익 계산(원금 100억 가정, 당일 투자시 다음주 실현손익을 의미)\n  mutate(REVENUE=PREMIUM+INTEREST-EXERCISE) %>% \n  # 거래대상 옵션이 상장되어있지 않은 경우, MMF수익만 고려\n  mutate(REVENUE=if_else(is.na(REVENUE),INTEREST,REVENUE)) %>% \n  mutate(RATE=REVENUE/cash,\n         Group=\"Vol-adj. Weekly\")  # 주단위 포트폴리오 수익률\n\n# 5. 비교군 포트폴리오 생성 : 월별 5% OTM 양매도 전략\noptions2 <- options %>% \n  filter(PROD==\"코스피200\")\n\n# 옵션 만기일(매달) 생성\ntarget_date2 <- options2 %>% \n  distinct(.,BAS_DD, PRIOR) %>% \n  arrange(PRIOR, desc(BAS_DD)) %>% \n  group_by(PRIOR) %>% \n  slice(1) %>% \n  ungroup() %>% \n  distinct(BAS_DD) %>% \n  arrange(desc(BAS_DD)) %>% \n  filter(BAS_DD<20250411)\n\n# 일반 양매도 포트폴리오 기본 정보 생성\ntarget_info2 <- target_date2 %>% \n  left_join(options2, by=\"BAS_DD\") %>% \n  distinct(BAS_DD,PRIOR) %>% \n  arrange(desc(BAS_DD),PRIOR) %>% \n  group_by(BAS_DD) %>% \n  # 만기가 도래하는 옵션을 제외하고 우선순위가 높은 옵션 선택\n  slice(2) %>% \n  ungroup() %>% \n  arrange(desc(BAS_DD)) %>% \n  left_join(idx_data, by=\"BAS_DD\") %>% \n  left_join(mmf_raw, by=\"BAS_DD\") %>% \n  # 옵션 보유기간 및 단기금리(MMF) 계산\n  mutate(DIFF_DAY=as.integer(ymd(lag(BAS_DD))-ymd(BAS_DD)),\n         MMF=MMF*0.01,\n         VOL=0.05) %>%\n  # 변동성에 따른 옵션 행사가격 상단(2.5단위 올림) 및 하단(2.5단위 내림) 계산\n  mutate(TARGET_C_K=ceiling(KOSPI200*(1+VOL)*0.4)/0.4,\n         TARGET_P_K=floor(KOSPI200*(1-VOL)*0.4)/0.4) %>% \n  mutate(DIFF_DAY=if_else(is.na(DIFF_DAY),28,DIFF_DAY)) %>% \n  select(BAS_DD,VOL,DIFF_DAY,MMF,KOSPI200,LAG_VK200,PRIOR,TARGET_C_K,TARGET_P_K)\n\n# 일반 양매도 포트폴리오 거래대상 옵션\ntarget_options2 <- target_info2 %>% \n  select(BAS_DD, PRIOR, TARGET_C_K, TARGET_P_K) %>% \n  pivot_longer(cols=c(\"TARGET_C_K\",\"TARGET_P_K\"),names_to = \"GRP\", values_to = \"EXER_PRC\") %>% \n  mutate(RGHT=substr(GRP,8,8)) %>% \n  left_join(options2,by=c(\"BAS_DD\",\"PRIOR\",\"RGHT\",\"EXER_PRC\")) %>%\n  select(BAS_DD,GRP,PRICE,ACC_TRDVOL) %>% \n  pivot_wider(names_from = \"GRP\", values_from = c(\"PRICE\",\"ACC_TRDVOL\"))\n\n# 일반 양매도 포트폴리오 구현\nportfolio2 <- target_info2 %>% \n  left_join(target_options2,by=\"BAS_DD\") %>% \n  arrange(BAS_DD) %>% \n  # 원금에 따른 옵션 매도수량 계산\n  mutate(SELL_AMT=cash/250000/KOSPI200) %>% \n  # 옵션 프리미엄(매도수익)) 계산\n  mutate(PREMIUM=SELL_AMT*(PRICE_TARGET_C_K+PRICE_TARGET_P_K)*250000) %>% \n  # 원금 및 프리미엄의 MMF 이자수익 및 권리행사손실 계산\n  mutate(INTEREST=(cash+replace_na(PREMIUM,0))*MMF*DIFF_DAY/365,\n         EXERCISE=(if_else(lead(KOSPI200)-TARGET_C_K>0,lead(KOSPI200)-TARGET_C_K,0)+\n                     if_else(TARGET_P_K-lead(KOSPI200)>0,TARGET_P_K-lead(KOSPI200),0))*250000*SELL_AMT) %>% \n  mutate(EXERCISE=if_else(is.na(EXERCISE),0,EXERCISE)) %>% \n  # 주단위 포트폴리오 손익 계산(원금 100억 가정, 당일 투자시 다음주 실현손익을 의미)\n  mutate(REVENUE=PREMIUM+INTEREST-EXERCISE) %>% \n  # 거래대상 옵션이 상장되어있지 않은 경우, MMF수익만 고려\n  mutate(REVENUE=if_else(is.na(REVENUE),INTEREST,REVENUE)) %>% \n  mutate(RATE=REVENUE/cash,\n         Group=\"Monthly\") # 주단위 포트폴리오 수익률\n\nportfolio <- portfolio %>% filter(BAS_DD!=20250410)\nportfolio2 <- portfolio2 %>% filter(BAS_DD!=20250410)\nportfolio3 <- portfolio %>% \n  summarise(across(where(is.numeric), sum)) %>% \n  mutate(Group=\"Vol-adj. Weekly Sum\")\n  \n\n# 요약표 4 : 검증 자료\ntable4 <- portfolio %>%\n  union_all(portfolio2) %>%\n  union_all(portfolio3) %>% \n  group_by(BAS_DD, Group) %>%\n  summarise(Premium = round(mean(PREMIUM)/10000,0),\n            Interest = round(mean(INTEREST)/10000,0),\n            Loss = round(mean(EXERCISE)/10000,0),\n            Revenue = round(mean(REVENUE)/10000,0),\n            Return = round(prod(1 + RATE)-1,2),\n            .groups = \"drop\")\n\n# 그래프 4 : 검증기간중 코스피200지수 추이\ngraph4 <- ggplot(idx_raw, aes(x = ymd(BAS_DD))) +\n  geom_line(aes(y = KOSPI200, color = \"KOSPI200\"), size = 1.2) +\n  geom_line(aes(y = (VKOSPI200 - 19) / 26 * 60 + 300, color = \"VKOSPI200\"), size = 1.2) +\n  geom_vline(xintercept = ymd(c(\"20250313\", \"20250320\", \"20250327\", \"20250403\",\"20250410\")),\n             linetype = \"dotted\", color = \"grey40\") +\n  scale_y_continuous(name = \"KOSPI200\",limits = c(300, 360),\n                     sec.axis = sec_axis(\n                       ~ (.-300) / 60 * 26 + 19, name = \"VKOSPI200\")) +\n  scale_color_manual(values = c(\"KOSPI200\" = \"blue\", \"VKOSPI200\" = \"red\"),\n                     guide = guide_legend(direction = \"horizontal\")) +\n  labs(title = \"Kospi200 & V-Kospi200 indices\",x = NULL,color = NULL) +\n  theme_minimal() +\n  scale_x_date(date_breaks = \"3 days\", date_labels = \"%m-%d\") +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1),\n        legend.position = c(0.5, 0.95))\n```\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"사례_과제.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.550","jupyter":{"kernelspec":{"name":"hwan","display_name":"hwan","language":"python"}},"code-block-bg":true,"code-block-border-left":"#31BAE9","theme":"cosmo","linestretch":2,"monofont":"Source Code Pro"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","include-in-header":["header.tex"],"output-file":"사례_과제.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"block-headings":true,"jupyter":{"kernelspec":{"name":"hwan","display_name":"hwan","language":"python"}},"code-block-bg":true,"code-block-border-left":"#31BAE9","documentclass":"scrreprt","papersize":"A4","margin-bottom":"20mm","margin-top":"15mm","margin-left":"15mm","margin-right":"15mm","monofontoptions":["Scale=0.8"]},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf"]}